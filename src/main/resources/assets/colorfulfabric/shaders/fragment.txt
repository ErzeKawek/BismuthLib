#version 430 core

in vec4 color;
in vec3 pos;
in vec2 uvAtlas;
in vec2 uvLight;

layout(binding = 0) uniform sampler2D atlas;
layout(binding = 2) uniform sampler2D lightmap;
layout(binding = 6) uniform sampler3D blocklight;

void main() {
	vec4 text = texture(atlas, uvAtlas);
	vec4 light = vec4(texture(lightmap, uvLight).rgb, 1);
	vec4 colorLight = vec4(texture(blocklight, pos).rgb, 1.0);
	vec4 mixed = color * text;
	//vec4 result = mixed * light + colorLight * mixed;
	vec4 result = mixed * light * (colorLight + vec4(1.0));
	result.a = mixed.a;
	//result.r = min(result.r, mixed.r * 1.3);
	//result.g = min(result.g, mixed.g * 1.3);
	//result.b = min(result.b, mixed.b * 1.3);
	gl_FragColor = result;
}
